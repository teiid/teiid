<!--This script builds a JAR for the Embedded Server Installation -->
<assembly>
  
  <id>jboss-dist</id>
  
  <formats>
    <format>zip</format>
  </formats>
  
  <includeBaseDirectory>false</includeBaseDirectory>
  <baseDirectory>teiid-${version}</baseDirectory>

  <fileSets>
          
    <fileSet>
        <directory>target/kits/jboss-container</directory>
        <outputDirectory>/</outputDirectory>      
        <includes>
          <include>**/*.sh</include>
        </includes>   
        <fileMode>755</fileMode>  
        <directoryMode>0755</directoryMode>    
    </fileSet> 
          
    <fileSet>
        <directory>target/kits/jboss-container</directory>
        <outputDirectory>/</outputDirectory>      
        <excludes>
          <exclude>**/*.sh</exclude>
        </excludes>      
        <fileMode>0644</fileMode>
        <directoryMode>0755</directoryMode>
    </fileSet>
          
    <!-- only true dependency file for any client --> 
    <fileSet>
      <directory>target</directory>
      <includes>
        <include>teiid-${version}-client.jar</include>
      </includes>
      <outputDirectory>lib</outputDirectory>
      <fileMode>0644</fileMode>
      <directoryMode>0755</directoryMode>
    </fileSet>

    <fileSet>
        <directory>../client/src/main/resources</directory>
        <includes>
            <include>vdb-deployer.xsd</include>
        </includes>                
        <outputDirectory>teiid-docs/schema</outputDirectory>
        <fileMode>0644</fileMode>
        <directoryMode>0755</directoryMode>        
    </fileSet>
    
	<!-- We may want to do this if including multiple doc types or languages
	     as the parent directory structure will be copied.  However the parent
	     directory permissions still seem wrong.
	<fileSet>
	  	<directory>target/distribution/teiid-${version}-docs</directory>
	  	<includes>
	  		<include>**/*.pdf</include>
	  	</includes>
	    <outputDirectory>teiid-docs</outputDirectory>
	    <fileMode>0644</fileMode>
	    <directoryMode>0755</directoryMode>
	</fileSet> -->
	
  </fileSets>
  
    <files>
        <file>
            <source>target/teiid-${version}-docs/admin-guide/en-US/pdf/teiid_admin_guide.pdf</source>
            <outputDirectory>teiid-docs</outputDirectory>
            <fileMode>0644</fileMode>
        </file>
        <file>
            <source>target/teiid-${version}-docs/reference/en-US/pdf/teiid_reference.pdf</source>
            <outputDirectory>teiid-docs</outputDirectory>
            <fileMode>0644</fileMode>
        </file>
        <file>
            <source>target/teiid-${version}-docs/quick-start-example/en-US/pdf/teiid_quick_start_example.pdf</source>
            <outputDirectory>teiid-docs</outputDirectory>
            <fileMode>0644</fileMode>
        </file>
        <file>
            <source>target/teiid-${version}-docs/developer-guide/en-US/pdf/teiid_developer_guide.pdf</source>
            <outputDirectory>teiid-docs</outputDirectory>
            <fileMode>0644</fileMode>
        </file>
        <file>
            <source>target/teiid-${version}-docs/client-developers-guide/en-US/pdf/teiid_client_developers_guide.pdf</source>
            <outputDirectory>teiid-docs</outputDirectory>
            <fileMode>0644</fileMode>
        </file>
        <file>
            <source>target/teiid-${version}-docs/caching-guide/en-US/pdf/teiid_caching_guide.pdf</source>
            <outputDirectory>teiid-docs</outputDirectory>
            <fileMode>0644</fileMode>
        </file>        
    </files>
     
  
  <!--  these have external dependent clients like connectors-->
  <moduleSets>
        
    <moduleSet>
      <useAllReactorProjects>true</useAllReactorProjects>
      <includes>
      	<include>org.jboss.teiid:teiid-hibernate-dialect</include>   
      </includes>
      <binaries>
		<includeDependencies>false</includeDependencies>
		<unpack>false</unpack>
        <outputDirectory>lib</outputDirectory>
      </binaries>
    </moduleSet>

    <!-- These are Teiid internal dependencies; to make JCA work -->
    <moduleSet>
        <includeSubModules>true</includeSubModules>
        <useAllReactorProjects>true</useAllReactorProjects>

        <includes>
            <include>org.jboss.teiid:teiid-jboss-integration</include>            
        </includes>

        <binaries>
            <includeDependencies>true</includeDependencies>
            <unpack>false</unpack>
            <dependencySets>
                <dependencySet>
                    <useProjectArtifact>true</useProjectArtifact>
                    <unpack>false</unpack>
                    <useTransitiveDependencies>true</useTransitiveDependencies>
                    <useDefaultExcludes>true</useDefaultExcludes>
                </dependencySet>
            </dependencySets>
            <outputDirectory>deployers/teiid.deployer</outputDirectory>
            <fileMode>0644</fileMode>
        </binaries>
    </moduleSet>
    
    <!-- These are built in connectors  -->
    <moduleSet>
        <includeSubModules>true</includeSubModules>
        <useAllReactorProjects>true</useAllReactorProjects>

        <includes>
            <include>org.jboss.teiid.connectors:connector-file:rar</include>
            <include>org.jboss.teiid.connectors:connector-ldap:rar</include>
            <include>org.jboss.teiid.connectors:connector-salesforce:rar</include>
            <include>org.jboss.teiid.connectors:connector-ws:rar</include>
        </includes>

        <binaries>   
          <outputFileNameMapping>teiid-${module.artifactId}.rar</outputFileNameMapping>     
          <includeDependencies>true</includeDependencies>
          <unpack>false</unpack>
            <dependencySets>
                <dependencySet>
                    <useProjectArtifact>true</useProjectArtifact>
                    <unpack>false</unpack>
                    <useTransitiveDependencies>false</useTransitiveDependencies>
                    <useDefaultExcludes>true</useDefaultExcludes>
                </dependencySet>
            </dependencySets>          
          <outputDirectory>deploy/teiid/connectors</outputDirectory>
          <fileMode>0644</fileMode>
        </binaries>
      
    </moduleSet>
    
    <!-- These are built in translators  -->
    <moduleSet>
        <includeSubModules>true</includeSubModules>
        <useAllReactorProjects>true</useAllReactorProjects>

        <includes>
            <include>org.jboss.teiid.connectors:translator-jdbc</include>
            <include>org.jboss.teiid.connectors:translator-loopback</include>
            <include>org.jboss.teiid.connectors:translator-file</include>
            <include>org.jboss.teiid.connectors:translator-ldap</include>
            <include>org.jboss.teiid.connectors:translator-salesforce</include>
            <include>org.jboss.teiid.connectors:translator-ws</include>
            <include>org.jboss.teiid.connectors:translator-olap</include>
        </includes>

        <binaries>        
          <includeDependencies>true</includeDependencies>
          <unpack>false</unpack>
            <dependencySets>
                <dependencySet>
                    <useProjectArtifact>true</useProjectArtifact>
                    <unpack>false</unpack>
                    <useTransitiveDependencies>false</useTransitiveDependencies>
                    <useDefaultExcludes>true</useDefaultExcludes>
                </dependencySet>
            </dependencySets>          
          <outputDirectory>deploy/teiid/connectors</outputDirectory>
          <fileMode>0644</fileMode>
        </binaries>
      
    </moduleSet>
        
    <!-- Include the JOPR plugin -->    
    <moduleSet>
        <includeSubModules>true</includeSubModules>
        <useAllReactorProjects>true</useAllReactorProjects>

        <includes>
            <include>org.jboss.teiid:teiid-console</include>
        </includes>

        <binaries>        
          <includeDependencies>false</includeDependencies>
          <unpack>false</unpack>
          <outputDirectory>deploy/admin-console.war/plugins</outputDirectory>
          <fileMode>0644</fileMode>
        </binaries>
      
    </moduleSet>        
    </moduleSets>  
</assembly>
